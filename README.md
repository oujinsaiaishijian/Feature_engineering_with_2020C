<center>憨憨欧第一次尝试做特征工程</center>



### 由来

笔者作为混子参加了2020年数学建模C题的过程，赶鸭子上架地完成了特征工程，还有一些乱七八杂的活。那次论文的效果不（非）是（常）很（地）好（差），但是让我感觉到了一些特征工程的快乐。

如果你只看过泰坦尼克号的数据集的话，你很难想象什么叫做特征工程。（但如果你不知道的话，这里推荐寒小阳的[博客](https://blog.csdn.net/han_xiaoyang/article/details/49797143)。）诸如人的称谓，性别，或者他们在船上住在具体的哪个船舱，你不会想着把它们组合起来的，这现实中似乎不容易找到有说服力的逻辑。

但是看附件1的数据集，你就会发现你除了可以提取出企业营收净利润的绝对值之类的显而易想象到的特征——还可以提炼出一些更有意思的特征，可能会激发你的想象。**你会说“哎！？我觉得这样一个特征可以很好地帮助我们对企业的分类做出贡献！”**譬如说企业上下游的稳定程度，企业营收与季度之间的关系等等。都是很有意思的事情。数据都在那里，你可以尝试着挖掘点什么。

数据都很干净，没有缺失值什么的，所以我们跳过了数据清洗的环节。而且我们大可以假设这里的数据都是很有用的。毕竟没有用的数据也不太会放到数学建模里面（的叭）

如果你也和我一样，空学了一点点机器学习的算法，不要说sklearn，连python都不太会用。但但还是想找个机会试试手，学习学习的话。

来吧，和我一起。



### 几点解释

虽然说是从特征工程开始，但是我学过的一些机器学习的算法我也会试试。都会是调包的。

另外，由于只有附件1给出了标签，附件2的标签是要做出预测的。所以现在这个项目暂定只在附件1上耍活儿。学习的过程我大概会事无巨细地记下来吧。？



### 之前构建的特征

之前构建了五个特征，分别是`'营收规模', '毛利率', '现金流', '优值交易比率', '供求稳定程度'`，虽然实际上几乎所有的特征都很有问题，但是还是可以给我一些启迪和改进的方向的。这里简单地说一下我们之前是怎么处理的。

-   营收规模：在销项发票信息中统计每家企业的价税合计的总额，没有考虑年份的平均。
-   毛利率：(销项发票信息中的价税合计总额 -  进项发票信息中的价税合计)/ 进项发票信息中的价税合计。
-   现金流：企业进账 + 企业开销,没有考虑年份的平均。
-   优值交易比率：考虑一些无效发票和负数发票的占比，其中由于负数发票造成的损失更为严重，所以给予其更高的惩罚项。
-   供求稳定程度：关注企业上游和下游的单位所占的比例，具体的计算过程不是我负责的所以也不说了。

这是在固定了随机种子之后得到的比较真实的对特征的评价吧。

```python
tree_clf.feature_importances_
>>>array([0.        , 0.30878364, 0.47841694, 0.21279942, 0.        ])

X_old.columns
>>>Index(['营收规模', '毛利率', '现金流', '优值交易比率', '供求稳定程度'], dtype='object')
```



对于特征处理的新的想法：

尝试精心构建地特征：



我想更加充分地挖掘**开票日期**所蕴含的信息，首先可以把时间细分为年度和月度。这样做的目的是**挖掘不同时间段内的某些指标的离散程度**。如果年和年之前的某些指标，比如说现金流有比较大的差异的话，我们有理由怀疑这不是一件很稳定的公司，不是吗。

按月度，或者说按季度划分也是基于这样一个想法。

但是在实操的时候发现信息不是在所有的月份上都出现的。像E1企业的进项发票信息，就直接从七月开始，销项发票信息就从八月开始的。这首先就带来两个问题：①：按季度划分不现实，因为有不少的企业可能没有完整的年度数据。②：**有不少的指标是需要综合进项发票信息和销项发票信息来看的。**还是拿E1企业举例子来说，七月份的时候就只有进项发票信息，没有销项发票信息的。也就是说在七月份的时候这家企业是没有收入的。那我就不知道应该怎么去描述E1企业在七月份的营收规模。因为根本就没有营收。

进一步的困难，假设我们有一个合理的方式刻画不同月份的企业的某些特征的不稳定程度，但是对于一家企业，如果它根本就没有多少月份的数据。我们可以合理地猜想这样的企业是有更大可能违约的，因为它没有什么活力。但是在不稳定程度上它就占了一个便宜，因为它根本就没有多少数据能体现它的”不稳定“。

所以我们必须想好怎样在更加细腻的时间尺度上构建特征。







需要重点重新研究的特征：**营收规模**，**供求稳定程度**。



为了“凑数”附赠上的特征：